<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * Copyright 2026 Adobe
 * All Rights Reserved.
 */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AdminVerifyCmsBlockWidgetDisplaysPerStoreViewTest">
        <annotations>
            <features value="Cms"/>
            <stories value="CMS Block Widget per Store View"/>
            <title value="CMS block widget displays correct content per store view"/>
            <description value="CMS block widget with same identifier displays correct content per store view."/>
            <severity value="MAJOR"/>
            <testCaseId value="AC-14472"/>
            <group value="Cms"/>
        </annotations>
        <before>
            <!-- Disable page builder and WYSIWYG -->
            <magentoCLI command="config:set {{DisablePageBuilderConfigData.path}} {{DisablePageBuilderConfigData.value}}" stepKey="disablePageBuilder"/>
            <actionGroup ref="AdminDisableWYSIWYGActionGroup" stepKey="disableWYSIWYG"/>
            <actionGroup ref="AdminLoginActionGroup" stepKey="loginAsAdmin"/>
        </before>
        <after>
            <!-- Delete widgets -->
            <actionGroup ref="AdminDeleteWidgetActionGroup" stepKey="deleteFirstWidget">
                <argument name="widget" value="CmsBlockWidgetDefaultStoreView"/>
            </actionGroup>
            <actionGroup ref="AdminDeleteWidgetActionGroup" stepKey="deleteSecondWidget">
                <argument name="widget" value="CmsBlockWidgetCustomStoreView"/>
            </actionGroup>
            <!-- Delete CMS blocks -->
            <actionGroup ref="deleteBlock" stepKey="deleteFirstBlock">
                <argument name="Block" value="CmsBlockForDefaultStoreView"/>
            </actionGroup>
            <actionGroup ref="deleteBlock" stepKey="deleteSecondBlock">
                <argument name="Block" value="CmsBlockForCustomStoreView"/>
            </actionGroup>
            <!-- Delete custom store view -->
            <actionGroup ref="AdminDeleteStoreViewActionGroup" stepKey="deleteCustomStoreView">
                <argument name="customStore" value="customStoreENNotUnique"/>
            </actionGroup>
            <!-- Re-enable page builder and WYSIWYG -->
            <magentoCLI command="config:set {{EnablePageBuilderConfigData.path}} {{EnablePageBuilderConfigData.value}}" stepKey="enablePageBuilder"/>
            <actionGroup ref="AdminEnableWYSIWYGActionGroup" stepKey="enableWYSIWYG"/>
            <actionGroup ref="AdminLogoutActionGroup" stepKey="logoutFromAdmin"/>
        </after>
        <!-- Step 1: Create custom store view -->
        <actionGroup ref="AdminCreateStoreViewActionGroup" stepKey="createCustomStoreView">
            <argument name="customStore" value="customStoreENNotUnique"/>
        </actionGroup>
        <!-- Step 2: Create first CMS block for default store view -->
        <actionGroup ref="AdminOpenCmsBlocksGridActionGroup" stepKey="openCmsBlocksGridForFirstBlock"/>
        <actionGroup ref="AdminPressAddNewCmsBlockButtonActionGroup" stepKey="pressAddNewBlockButtonFirst"/>
        <actionGroup ref="AdminFillCmsBlockFormActionGroup" stepKey="fillFirstCmsBlockForm">
            <argument name="cmsBlockDataTitle" value="{{CmsBlockForDefaultStoreView.title}}"/>
            <argument name="cmsBlockDataIdentifier" value="{{CmsBlockForDefaultStoreView.identifier}}"/>
            <argument name="cmsBlockDataContent" value="{{CmsBlockForDefaultStoreView.content}}"/>
        </actionGroup>
        <actionGroup ref="AdminSelectCMSBlockStoreViewActionGroup" stepKey="selectDefaultStoreViewForBlock">
            <argument name="storeViewName" value="{{_defaultStore.name}}"/>
        </actionGroup>
        <actionGroup ref="AdminPressSaveCmsBlockButtonActionGroup" stepKey="saveFirstCmsBlock"/>
        <actionGroup ref="AssertMessageInAdminPanelActionGroup" stepKey="assertFirstBlockSaved">
            <argument name="message" value="You saved the block."/>
        </actionGroup>
        <!-- Step 3: Create second CMS block with same identifier for custom store view -->
        <actionGroup ref="AdminOpenCmsBlocksGridActionGroup" stepKey="openCmsBlocksGridForSecondBlock"/>
        <actionGroup ref="AdminPressAddNewCmsBlockButtonActionGroup" stepKey="pressAddNewBlockButtonSecond"/>
        <actionGroup ref="AdminFillCmsBlockFormActionGroup" stepKey="fillSecondCmsBlockForm">
            <argument name="cmsBlockDataTitle" value="{{CmsBlockForCustomStoreView.title}}"/>
            <argument name="cmsBlockDataIdentifier" value="{{CmsBlockForCustomStoreView.identifier}}"/>
            <argument name="cmsBlockDataContent" value="{{CmsBlockForCustomStoreView.content}}"/>
        </actionGroup>
        <actionGroup ref="AdminSelectCMSBlockStoreViewActionGroup" stepKey="selectCustomStoreViewForBlock">
            <argument name="storeViewName" value="{{customStoreENNotUnique.name}}"/>
        </actionGroup>
        <actionGroup ref="AdminPressSaveCmsBlockButtonActionGroup" stepKey="saveSecondCmsBlock"/>
        <actionGroup ref="AssertMessageInAdminPanelActionGroup" stepKey="assertSecondBlockSaved">
            <argument name="message" value="You saved the block."/>
        </actionGroup>
        <!-- Step 4: Create widget for default store view with first CMS block -->
        <actionGroup ref="AdminCreateWidgetWithEnabledBlockActionGroup" stepKey="createWidgetForDefaultStoreView">
            <argument name="widget" value="CmsBlockWidgetDefaultStoreView"/>
            <argument name="block" value="{{CmsBlockForDefaultStoreView.title}}"/>
        </actionGroup>
        <!-- Step 5: Create widget for custom store view with second CMS block -->
        <actionGroup ref="AdminCreateWidgetWithEnabledBlockActionGroup" stepKey="createWidgetForCustomStoreView">
            <argument name="widget" value="CmsBlockWidgetCustomStoreView"/>
            <argument name="block" value="{{CmsBlockForCustomStoreView.title}}"/>
        </actionGroup>
        <!-- Step 6: Verify first CMS block displays on default store view -->
        <actionGroup ref="StorefrontOpenHomePageActionGroup" stepKey="goToHomePage"/>
        <waitForText userInput="{{CmsBlockForDefaultStoreView.content}}" stepKey="seeFirstBlockContent"/>
        <!-- Step 7: Verify second CMS block displays on custom store view -->
        <actionGroup ref="StorefrontSwitchStoreViewActionGroup" stepKey="switchToCustomStoreView">
            <argument name="storeView" value="customStoreENNotUnique"/>
        </actionGroup>
        <waitForText userInput="{{CmsBlockForCustomStoreView.content}}" stepKey="seeSecondBlockContent"/>
        <!-- Verify first block content is not visible on custom store view -->
        <dontSeeInPageSource userInput="{{CmsBlockForDefaultStoreView.content}}" stepKey="dontSeeFirstBlockContentOnCustomStore"/>
    </test>
</tests>
